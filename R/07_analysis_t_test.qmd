---
title: "07_analysis_t_test"
author: "Julie Bruun Brockhoff (s204519), Cecilie Kejlberg Leth (s204584), Amalie Drud Nielsen (s204560), Chrysillis Hellemann Polhaus (s153664), Lise Lotte Eriksen (s154123)"
format: 
  html:
    embed-resources: true
editor: visual
  markdown: 
    wrap: 72
---

### Load packages

```{r}
library(tidyverse)
library(broom)
```

### Load data

```{r}
data <- read_tsv("../data/03_dat_aug.tsv")
```

### Data for analysis

Pivot data to long format

```{r}
mock_or_ko <- data |> 
  select(gene, 
         contains("MOCK"), 
         contains("_KO")) |> 
  pivot_longer(cols = c(OVCAR3_MOCK, 
                        OVCAR3_KO, 
                        SKOV3_MOCK, 
                        SKOV3_KO), 
               names_to = c(".value", 
                            "MOCK_or_KO"), 
               names_pattern = "(.*)_(.*)" )
```

### Correlation between KO and MOCK

Fitting linear models of how the two cell lines correlate for both KO and MOCK

```{r}
model_KO <- mock_or_ko |> 
  filter(MOCK_or_KO == "KO") |> 
  lm(formula = SKOV3 ~ OVCAR3)

model_MOCK <- mock_or_ko |> 
  filter(MOCK_or_KO == "MOCK") |> 
  lm(formula = SKOV3 ~ OVCAR3)

summary(model_KO)
summary(model_MOCK)
```

### Scatter plot between KO and MOCK

Scatter plot showing the difference between KO and MOCK including the values from the linear models

```{r}
mock_or_ko |> 
  ggplot(mapping = aes(x = OVCAR3, 
                       y = SKOV3, 
                       color = MOCK_or_KO)) +
  geom_point() + 
  geom_smooth(method = lm,
              se = FALSE) +
  labs(title = "Gene expression in the two cell lines for MOCK and KO",
       color = "MOCK or KO") +
  theme_minimal() +
  scale_x_continuous(limits = c(0,730000)) +
  scale_y_continuous(limits = c(0,730000)) +
  annotate("text", 
           x = 590000, 
           y = 250000, 
           size = 3.5,
           label = "R^2 = 0.64") +
  annotate("text", 
           x = 590000, 
           y = 220000, 
           size = 3.5,
           label = "y = 0.29x + 372.26") +
  annotate("text", 
           x = 80000, 
           y = 290000, 
           size = 3.5,
           label = "R^2 = 0.89") +
    annotate("text", 
           x = 80000, 
           y = 260000, 
           size = 3.5,
           label = "y = 1.21x + 83.48")

```

### Statistics: t-test and p-values

Using a t-test to check whether or not the KO and MOCK samples are different for each cell line

```{r}
KO_OVCAR3 <- mock_or_ko |> 
  filter(MOCK_or_KO == "KO") |> 
  select(OVCAR3)
MOCK_OVCAR3 <- mock_or_ko |> 
  filter(MOCK_or_KO == "MOCK") |> 
  select(OVCAR3)

broom::tidy(t.test(KO_OVCAR3, MOCK_OVCAR3), paired = TRUE)|> 
  pull(p.value)


KO_SKOV3 <- mock_or_ko |> 
  filter(MOCK_or_KO == "KO") |> 
  select(SKOV3)
MOCK_SKOV3 <- mock_or_ko |> 
  filter(MOCK_or_KO == "MOCK") |> 
  select(SKOV3)

broom::tidy(t.test(KO_SKOV3, MOCK_SKOV3), paired = TRUE)|> 
  pull(p.value)
```

The p-value is 0.74 for OVCAR3. This means that there are no statistical significant difference between the values of KO vs MOCK in this cell line.

The p-value is 5.84e-17 for SKOV3. This means that there are a strong statistical significant difference between the values of KO vs MOCK in this cell line.
